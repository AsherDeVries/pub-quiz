{"version":3,"sources":["../../src/websockets/non-quizmaster.js"],"names":["quiznightCode","quiznightNamespace","webSocketServer","of","on","socket","emit","PENDING","nsp","name","CONNECT_TEAM","message","update","_id","substr","$push","teams","teamName","roundPoints","then","to","id"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;;;kBAEe,UAACA,aAAD,EAAmB;AAChC,MAAIC,qBAAqB,cAAIC,eAAJ,CAAoBC,EAApB,CAAuB,MAAMH,aAA7B,CAAzB;;AAEAC,qBAAmBG,EAAnB,CAAsB,YAAtB,EAAoC,UAACC,MAAD,EAAY;AAC9CA,WAAOC,IAAP,CAAY,wBAAcC,OAA1B,2CAA0EF,OAAOG,GAAP,CAAWC,IAArF;AACA;;AAEAJ,WAAOD,EAAP,CAAU,wBAAcM,YAAxB,EAAsC,UAACC,OAAD,EAAa;AACjD,0BAAUC,MAAV,CACE,EAAEC,KAAKR,OAAOG,GAAP,CAAWC,IAAX,CAAgBK,MAAhB,CAAuB,CAAvB,CAAP,EADF,EAEE,EAAEC,OAAO,EAAEC,OAAO,EAAEH,KAAKF,QAAQM,QAAf,EAAyBC,aAAa,CAAtC,EAAT,EAAT,EAFF,EAGGC,IAHH,CAGQ,cAAIjB,eAAJ,CAAoBkB,EAApB,CAAuB,iBAAvB,EAA0Cd,IAA1C,CAA+C,SAA/C,EAA0D;AAC9D,+CAAsCK,QAAQM,QAA9C,0BAA2EZ,OAAOgB,EAAlF,qDAAoIhB,OAAOG,GAAP,CAAWC;AADjF,OAA1D,CAHR;AAMC,KAPH;AAQC,GAZH;;AAcA,SAAOR,kBAAP;AACD,C","file":"non-quizmaster.js","sourcesContent":["import app from '../app';\nimport Quiznight from '../models/Quiznight';\nimport MESSAGE_TYPES from './constants/message_types';\n\nexport default (quiznightCode) => {\n  let quiznightNamespace = app.webSocketServer.of('/' + quiznightCode);\n\n  quiznightNamespace.on('connection', (socket) => {\n    socket.emit(MESSAGE_TYPES.PENDING, `Welcome to the quiznight with code: ${socket.nsp.name}! Send your teamname to join.`);\n    // TODO: refactor code below to redirect quizmaster to created namespace\n    \n    socket.on(MESSAGE_TYPES.CONNECT_TEAM, (message) => {\n      Quiznight.update(\n        { _id: socket.nsp.name.substr(1) },\n        { $push: { teams: { _id: message.teamName, roundPoints: 0 } } })\n        .then(app.webSocketServer.to('QUIZMASTER_ROOM').emit('PENDING', { \n          'message' : `A new team with name: \"${message.teamName}\" and socket id: \"${socket.id}\" is waiting to join the quiznight with code ${socket.nsp.name}` \n        }));\n      });\n    });\n\n  return quiznightNamespace;\n}"]}