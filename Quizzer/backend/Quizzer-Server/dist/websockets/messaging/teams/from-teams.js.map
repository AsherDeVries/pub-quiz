{"version":3,"sources":["../../../../src/websockets/messaging/teams/from-teams.js"],"names":["socket","quiznightNamespace","on","CONNECT_TEAM","message","quiznightCode","addTeamToCache","teamName","saveNewTeamInQuiznightToCache","then","toNamespace","usingSocket","sendMessageToQuizmaster","TEAM_JOINED","socketId","id","join","TEAMS","SUBMIT_ANSWER","qnCode","saveAnswerOfTeamInRoundToCache","round","question","answer","ANSWER_SUBMITTED","sendMessageToAllScoreboards","hasAnswered"],"mappings":";;;;;;AAAA;;;;AACA;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;kBAEe,UAACA,MAAD,EAASC,kBAAT,EAAgC;AAC7CD,SAAOE,EAAP,CAAU,wBAAcC,YAAxB,EAAsC,UAACC,OAAD,EAAa;AACjD,QAAIC,gBAAgB,uCAA2BL,MAA3B,CAApB;AACA,0BACGM,cADH,CACkBD,aADlB,EACiCD,QAAQG,QADzC,EACmDP,MADnD;;AAGA,uBACGQ,6BADH,CACiCH,aADjC,EACgDD,QAAQG,QADxD,EAEGE,IAFH,CAEQ,YAAM;AACV,6BACGC,WADH,CACeT,kBADf,EAEGU,WAFH,CAEeX,MAFf,EAGGY,uBAHH,CAG2B,wBAAcC,WAHzC,EAGsD;AAClDN,kBAAUH,QAAQG,QADgC;AAElDO,kBAAUd,OAAOe;AAFiC,OAHtD;AAOAf,aAAOgB,IAAP,CAAY,gBAAWC,KAAvB;AACD,KAXH;AAYD,GAjBD;;AAmBAjB,SAAOE,EAAP,CAAU,wBAAcgB,aAAxB,EAAuC,UAACd,OAAD,EAAa;AAClD,QAAIe,SAAS,uCAA2BnB,MAA3B,CAAb;AACA,uBACGoB,8BADH,CACkCD,MADlC,EAC0Cf,QAAQiB,KADlD,EACyDjB,QAAQG,QADjE,EAC2EH,QAAQkB,QADnF,EAC6FlB,QAAQmB,MADrG,EAEGd,IAFH,CAEQ,YAAM;AACV,6BACGC,WADH,CACeT,kBADf,EAEGU,WAFH,CAEeX,MAFf,EAGGY,uBAHH,CAG2B,wBAAcY,gBAHzC,EAG2D,EAAEF,UAAUlB,QAAQkB,QAApB,EAA8BC,QAAQnB,QAAQmB,MAA9C,EAH3D;;AAKA,6BACGE,2BADH,CAC+B,wBAAcD,gBAD7C,EAC+D,EAAEjB,UAAUH,QAAQG,QAApB,EAA8BmB,aAAa,IAA3C,EAD/D;AAED,KAVH;AAWD,GAbD;AAcD,C","file":"from-teams.js","sourcesContent":["import DatabaseCacheHandler from '../../caching/database';\nimport { getQuiznightCodeFromSocket } from '../../utils';\nimport MESSAGE_TYPES from '../../constants/message_types';\nimport QuizmasterMessageSender from '../quizmaster/to-quizmaster';\nimport Quiznight from '../../../models/Quiznight';\nimport ROOM_NAMES from '../../constants/rooms';\nimport ScoreboardMessageSender from '../scoreboard/to-scoreboard';\nimport TeamWebsocketConnectionsCacheHandler from '../../caching/connections';\n\nexport default (socket, quiznightNamespace) => {\n  socket.on(MESSAGE_TYPES.CONNECT_TEAM, (message) => {\n    let quiznightCode = getQuiznightCodeFromSocket(socket);\n    TeamWebsocketConnectionsCacheHandler\n      .addTeamToCache(quiznightCode, message.teamName, socket);\n      \n    DatabaseCacheHandler\n      .saveNewTeamInQuiznightToCache(quiznightCode, message.teamName)\n      .then(() => {\n        QuizmasterMessageSender\n          .toNamespace(quiznightNamespace)\n          .usingSocket(socket)\n          .sendMessageToQuizmaster(MESSAGE_TYPES.TEAM_JOINED, {\n            teamName: message.teamName,\n            socketId: socket.id\n          });\n        socket.join(ROOM_NAMES.TEAMS);\n      });\n  });\n\n  socket.on(MESSAGE_TYPES.SUBMIT_ANSWER, (message) => {\n    let qnCode = getQuiznightCodeFromSocket(socket);\n    DatabaseCacheHandler\n      .saveAnswerOfTeamInRoundToCache(qnCode, message.round, message.teamName, message.question, message.answer)\n      .then(() => {\n        QuizmasterMessageSender\n          .toNamespace(quiznightNamespace)\n          .usingSocket(socket)\n          .sendMessageToQuizmaster(MESSAGE_TYPES.ANSWER_SUBMITTED, { question: message.question, answer: message.answer });\n\n        ScoreboardMessageSender\n          .sendMessageToAllScoreboards(MESSAGE_TYPES.ANSWER_SUBMITTED, { teamName: message.teamName, hasAnswered: true });\n      });\n  });\n}"]}